---
# Description: Validate core user password is set and strong
# POLICY CHANGE: No auto-generation - passwords MUST be provided
# Included by user_management.yml for each core user

- name: auth-pwd-gen - Extract user config
  set_fact:
    pwd_core_name: "{{ core_user_item.0.name }}"
    pwd_user: "{{ core_user_item.1 }}"
  no_log: true

- name: auth-pwd-gen - Validate password is set and strong
  assert:
    that:
      - pwd_user.password is defined
      - pwd_user.password | length >= 12
    fail_msg: |
      ==========================================
      CRITICAL ERROR: Password not set for Multi-Core user!
      ==========================================

      Core: {{ pwd_core_name }}
      User: {{ pwd_user.username }}

      REQUIRED:
        solr_cores:
          - name: "{{ pwd_core_name }}"
            users:
              - username: "{{ pwd_user.username }}"
                password: "your-secure-password-here"  # MUST BE SET!

      REQUIREMENTS:
        - Minimum length: 12 characters
        - Must be explicitly defined in host_vars or group_vars

      LOCATION:
        {{ inventory_dir }}/{{ inventory_hostname }}
        or
        {{ playbook_dir }}/host_vars/{{ inventory_hostname }}.yml

      ==========================================
    success_msg: "Core '{{ pwd_core_name }}' user '{{ pwd_user.username }}' password validated ({{ pwd_user.password | length }} chars)"
