---
# Version: 2.1.0
# Description: Display generated credentials for admin reference
# Called at end of deployment

- name: credentials-display - Check if any passwords were generated
  set_fact:
    has_generated_passwords: "{{ (generate_admin_password | default(false)) or (generate_support_password | default(false)) or (generate_moodle_password | default(false)) or (generated_credentials | default([]) | length > 0) }}"

- name: credentials-display - Display header
  debug:
    msg:
      - "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
      - "â•‘                 ğŸ” GENERATED CREDENTIALS                              â•‘"
      - "â•‘                                                                       â•‘"
      - "â•‘  âš ï¸  WICHTIG: PasswÃ¶rter wurden automatisch generiert!                â•‘"
      - "â•‘  Bitte in host_vars speichern und WebUI-Login testen!                â•‘"
      - "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
      - "â•‘  GLOBALE ADMIN-USER:                                                  â•‘"
      - "â•‘                                                                       â•‘"
  when: has_generated_passwords | bool

- name: credentials-display - Display admin credentials
  debug:
    msg:
      - "â•‘  âœ¨ Admin User (NEU GENERIERT):                                       â•‘"
      - "â•‘     Username: {{ solr_admin_user }}"
      - "â•‘     Password: {{ solr_admin_password_final }}"
      - "â•‘     HinzufÃ¼gen zu host_vars:                                          â•‘"
      - "â•‘     solr_admin_password: \"{{ solr_admin_password_final }}\""
      - "â•‘                                                                       â•‘"
  when:
    - has_generated_passwords | bool
    - generate_admin_password | default(false)

- name: credentials-display - Display support credentials
  debug:
    msg:
      - "â•‘  âœ¨ Support User (NEU GENERIERT):                                     â•‘"
      - "â•‘     Username: {{ solr_support_user }}"
      - "â•‘     Password: {{ solr_support_password_final }}"
      - "â•‘     HinzufÃ¼gen zu host_vars:                                          â•‘"
      - "â•‘     solr_support_password: \"{{ solr_support_password_final }}\""
      - "â•‘                                                                       â•‘"
  when:
    - has_generated_passwords | bool
    - generate_support_password | default(false)

- name: credentials-display - Display moodle credentials
  debug:
    msg:
      - "â•‘  âœ¨ Moodle User (NEU GENERIERT):                                      â•‘"
      - "â•‘     Username: {{ solr_moodle_user }}"
      - "â•‘     Password: {{ solr_moodle_password_final }}"
      - "â•‘     HinzufÃ¼gen zu host_vars:                                          â•‘"
      - "â•‘     solr_moodle_password: \"{{ solr_moodle_password_final }}\""
      - "â•‘                                                                       â•‘"
  when:
    - has_generated_passwords | bool
    - generate_moodle_password | default(false)

- name: credentials-display - Display multi-core header
  debug:
    msg:
      - "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
      - "â•‘  MULTI-CORE USER (NEU GENERIERT):                                    â•‘"
      - "â•‘                                                                       â•‘"
  when:
    - has_generated_passwords | bool
    - generated_credentials | default([]) | length > 0

- name: credentials-display - Display multi-core credentials
  debug:
    msg:
      - "â•‘  Core: {{ item.core }}_core"
      - "â•‘     Username: {{ item.username }}"
      - "â•‘     Password: {{ item.password }}"
      - "â•‘                                                                       â•‘"
      - "â•‘     HinzufÃ¼gen zu host_vars:                                          â•‘"
      - "â•‘     solr_cores:"
      - "â•‘       - name: \"{{ item.core }}\""
      - "â•‘         users:"
      - "â•‘           - username: \"{{ item.username }}\""
      - "â•‘             password: \"{{ item.password }}\""
      - "â•‘                                                                       â•‘"
  loop: "{{ generated_credentials | default([]) }}"
  when:
    - has_generated_passwords | bool
    - item.was_generated | default(false)

- name: credentials-display - Display WebUI test instructions
  debug:
    msg:
      - "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
      - "â•‘  ğŸŒ WEBUI LOGIN TESTEN:                                               â•‘"
      - "â•‘                                                                       â•‘"
      - "â•‘  URL: {{ 'https' if ssl_actually_enabled | default(false) else 'http' }}://{{ solr_app_domain }}{{ solr_proxy_path | default('/solr-admin') }}/"
      - "â•‘                                                                       â•‘"
      - "â•‘  Test-Befehle:                                                        â•‘"
  when: has_generated_passwords | bool

- name: credentials-display - Display admin test command
  debug:
    msg:
      - "â•‘  curl -u {{ solr_admin_user }}:{{ solr_admin_password_final }} \\"
      - "â•‘       {{ 'https' if ssl_actually_enabled | default(false) else 'http' }}://{{ solr_app_domain }}{{ solr_proxy_path | default('/solr-admin') }}/admin/ping"
      - "â•‘                                                                       â•‘"
  when:
    - has_generated_passwords | bool
    - generate_admin_password | default(false)

- name: credentials-display - Display multi-core test command
  debug:
    msg:
      - "â•‘  curl -u {{ item.username }}:{{ item.password }} \\"
      - "â•‘       {{ 'https' if ssl_actually_enabled | default(false) else 'http' }}://{{ solr_app_domain }}{{ solr_proxy_path | default('/solr-admin') }}/{{ item.core }}_core/admin/ping"
      - "â•‘                                                                       â•‘"
  loop: "{{ generated_credentials | default([]) }}"
  loop_control:
    label: "{{ item.core }}_core"
  when:
    - has_generated_passwords | bool
    - generated_credentials | default([]) | length > 0
    - item.was_generated | default(false)
  run_once: true

- name: credentials-display - Display footer
  debug:
    msg:
      - "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
      - "â•‘  ğŸ’¾ WICHTIG: Credentials in host_vars sichern!                        â•‘"
      - "â•‘  Sonst werden beim nÃ¤chsten Deployment neue PasswÃ¶rter generiert!    â•‘"
      - "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  when: has_generated_passwords | bool

- name: credentials-display - No passwords generated
  debug:
    msg:
      - "âœ… Alle PasswÃ¶rter wurden aus host_vars Ã¼bernommen"
      - "   Keine automatische Generierung erforderlich"
  when: not has_generated_passwords | bool
