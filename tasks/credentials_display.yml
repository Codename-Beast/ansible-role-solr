---
# Version: 2.0.0
# Description: Display generated credentials for admin reference
# Called at end of deployment

- name: credentials-display - Check if any passwords were generated
  set_fact:
    has_generated_passwords: "{{ (generate_admin_password | default(false)) or (generate_support_password | default(false)) or (generate_moodle_password | default(false)) or (generated_credentials | default([]) | length > 0) }}"

- name: credentials-display - Display generated credentials
  debug:
    msg:
      - "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
      - "â•‘                 ğŸ” GENERATED CREDENTIALS                              â•‘"
      - "â•‘                                                                       â•‘"
      - "â•‘  âš ï¸  WICHTIG: PasswÃ¶rter wurden automatisch generiert!                â•‘"
      - "â•‘  Bitte in host_vars speichern und WebUI-Login testen!                â•‘"
      - "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
      - "â•‘  GLOBALE ADMIN-USER:                                                  â•‘"
      - "â•‘                                                                       â•‘"
      - "{% if generate_admin_password | default(false) %}â•‘  âœ¨ Admin User (NEU GENERIERT):                                       â•‘"
      - "â•‘     Username: {{ solr_admin_user }}                                  "
      - "â•‘     Password: {{ solr_admin_password_final }}                        "
      - "â•‘     HinzufÃ¼gen zu host_vars:                                          â•‘"
      - "â•‘     solr_admin_password: \"{{ solr_admin_password_final }}\"          "
      - "â•‘                                                                       â•‘{% endif %}"
      - "{% if generate_support_password | default(false) %}â•‘  âœ¨ Support User (NEU GENERIERT):                                     â•‘"
      - "â•‘     Username: {{ solr_support_user }}                                "
      - "â•‘     Password: {{ solr_support_password_final }}                      "
      - "â•‘     HinzufÃ¼gen zu host_vars:                                          â•‘"
      - "â•‘     solr_support_password: \"{{ solr_support_password_final }}\"      "
      - "â•‘                                                                       â•‘{% endif %}"
      - "{% if generate_moodle_password | default(false) %}â•‘  âœ¨ Moodle User (NEU GENERIERT):                                      â•‘"
      - "â•‘     Username: {{ solr_moodle_user }}                                 "
      - "â•‘     Password: {{ solr_moodle_password_final }}                       "
      - "â•‘     HinzufÃ¼gen zu host_vars:                                          â•‘"
      - "â•‘     solr_moodle_password: \"{{ solr_moodle_password_final }}\"        "
      - "â•‘                                                                       â•‘{% endif %}"
      - "{% if generated_credentials | default([]) | length > 0 %}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
      - "â•‘  MULTI-CORE USER (NEU GENERIERT):                                    â•‘"
      - "â•‘                                                                       â•‘{% for cred in generated_credentials %}{% if cred.was_generated %}â•‘  Core: {{ cred.core }}_core                                           "
      - "â•‘     Username: {{ cred.username }}                                    "
      - "â•‘     Password: {{ cred.password }}                                    "
      - "â•‘                                                                       â•‘"
      - "â•‘     HinzufÃ¼gen zu host_vars:                                          â•‘"
      - "â•‘     solr_cores:                                                       â•‘"
      - "â•‘       - name: \"{{ cred.core }}\"                                     "
      - "â•‘         users:                                                        â•‘"
      - "â•‘           - username: \"{{ cred.username }}\"                         "
      - "â•‘             password: \"{{ cred.password }}\"                         "
      - "â•‘                                                                       â•‘{% endif %}{% endfor %}{% endif %}"
      - "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
      - "â•‘  ğŸŒ WEBUI LOGIN TESTEN:                                               â•‘"
      - "â•‘                                                                       â•‘"
      - "â•‘  URL: {{ 'https' if solr_ssl_enabled | default(false) else 'http' }}://{{ solr_app_domain }}{{ solr_proxy_path | default('/solr-admin') }}/"
      - "â•‘                                                                       â•‘"
      - "â•‘  Test-Befehle:                                                        â•‘"
      - "{% if generate_admin_password | default(false) %}â•‘  curl -u {{ solr_admin_user }}:{{ solr_admin_password_final }} \     "
      - "â•‘       {{ 'https' if solr_ssl_enabled | default(false) else 'http' }}://{{ solr_app_domain }}{{ solr_proxy_path | default('/solr-admin') }}/admin/ping"
      - "â•‘                                                                       â•‘{% endif %}"
      - "{% if generated_credentials | default([]) | length > 0 %}{% for cred in generated_credentials | selectattr('was_generated') | list | first %}â•‘  curl -u {{ cred.username }}:{{ cred.password }} \                     "
      - "â•‘       {{ 'https' if solr_ssl_enabled | default(false) else 'http' }}://{{ solr_app_domain }}{{ solr_proxy_path | default('/solr-admin') }}/{{ cred.core }}_core/admin/ping"
      - "â•‘                                                                       â•‘{% endfor %}{% endif %}"
      - "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
      - "â•‘  ğŸ’¾ WICHTIG: Credentials in host_vars sichern!                        â•‘"
      - "â•‘  Sonst werden beim nÃ¤chsten Deployment neue PasswÃ¶rter generiert!    â•‘"
      - "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  when: has_generated_passwords | bool

- name: credentials-display - No passwords generated
  debug:
    msg:
      - "âœ… Alle PasswÃ¶rter wurden aus host_vars Ã¼bernommen"
      - "   Keine automatische Generierung erforderlich"
  when: not has_generated_passwords | bool
